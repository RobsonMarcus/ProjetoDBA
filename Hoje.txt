--select * from scriptVersoes
--select * from scriptExecutecLog
--drop table scriptVersoes
--create table scriptVersoes( 
--/* -- Table de script de atualização e carga de versão

--Tipo de script
--- Update
--- Complementar
--- Carga

--*/
--Id int IDENTITY (1,1) NOT NULL,
--Versao varchar(100),
--PathScript varchar(200),
--NomeScript varchar(300),
--TipoScript varchar(100),
--DataCriacao DateTime NOT NULL DEFAULT (GETDATE()),
--DataCadastro Datetime NOT NULL DEFAULT (GETDATE())
--)

--create table scriptExecutecLog( -- Table de log de execução do script
--Id int IDENTITY (1,1) NOT NULL,
--Versao varchar(100),
--PathLogScript varchar(200),
--LogScript varchar(300),
--TipoScript varchar(100),
--DataInicioExec DateTime NOT NULL DEFAULT (GETDATE()),
--DataFinalExec DateTime NOT NULL DEFAULT (GETDATE()),
--)


--17  K.2020.06.4 Update K.2020.05.3.sql


--EXEC('E:\Bancos\scriptAtuliza\17  K.2020.06.4 Update K.2020.05.3.sql')

--sqlcmd -S [server] -d [database] -U [usuario] -P [senha] -i [script.sql] -o [log.txt]

--xp_cmdshell 'sqlcmd -S ROBSON-DELL -d KLINIKOSNET_AME -i "E:\Bancos\scriptAtuliza\19 K.2020.06.7 Update K.2020.06.6.sql" -o "E:\Bancos\scriptAtuliza\LogTSQL\19 K.2020.06.7 Update K.2020.06.6.txt"'

--select * from KLINIKOSNET_AME.dbo.Database_Version_Control order by 3 desc

--INSERT INTO scriptVersoes (Path,NomeScript,TipoScript,DataCadastro)
--VALUES('E:\Bancos\scriptAtuliza\','17  K.2020.06.4 Update K.2020.05.3.sql','UpDate',GETDATE())

create table #tempSCRIT
(
Id int IDENTITY (1,1),
diretorio varchar(400)
)
INSERT INTO #tempSCRIT
exec ('xp_cmdshell "dir E:\Bancos\scriptAtuliza /c/o n"')
DELETE FROM #tempSCRIT where Id between 1 AND 7
DBCC CHECKIDENT('#tempSCRIT',RESEED,1) 
--select LEFT(diretorio,17) from #tempSCRIT 
create table #tempSCRIT2
(
Id int IDENTITY (1,1),
diretorio varchar(400)
)
INSERT INTO #tempSCRIT2
exec ('xp_cmdshell "dir E:\Bancos\scriptAtuliza /b"')


--select #tempSCRIT2.diretorio, LEFT(#tempSCRIT.diretorio,17)from #tempSCRIT2
--JOIN #tempSCRIT ON #tempSCRIT2.Id = #tempSCRIT.Id


--drop table #tempSCRIT
--drop table #tempSCRIT2

DBCC HELP('checkident')
